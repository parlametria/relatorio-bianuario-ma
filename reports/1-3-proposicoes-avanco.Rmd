---
title: "Situação das proposições"
output:
  html_document:
    theme: paper
    css: styles.css
---

```{r setup, include=FALSE, echo=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  # fig.cap = '',
  warning = FALSE,
  # fig.align = 'center',
  fig.width = 8,
  fig.height = 5
)

Sys.setenv(LANGUAGE="pt-br")
Sys.setlocale("LC_TIME", "pt_BR")
options(scipen = 999)
```

```{r warning=FALSE, message=FALSE}
library(tidyverse)
library(ggbeeswarm)
library(ggchicklet)
library(hrbrthemes)
library(reactable)
theme_set(theme_ipsum_rc())

source(here::here("code/read_ready.R"))
source(here::here("reports/autorias.R"))
source(here::here("reports/escalas.R"))
```

```{r}
proposicoes = read_proposicoes()
detalhes_autorias = read_autorias_det()
resumo_autorias = read_autorias_res() %>%  
  select(-situacao,
         -em_exercicio,
         -is_parlamentar,
         -sexo,
         -starts_with("id"))
```

## Avanço na tramitação

```{r}
situacao = proposicoes %>% 
  pivot_longer(c(urgencia, avanco, status), names_to = "aspecto", values_to = "situacao") 
```


```{r}
situacao %>% 
  filter(!(situacao %in% c("Ativa", "Sem urgência", "Ainda no início"))) %>% 
  count(aspecto, situacao, classificacao_ambientalismo) %>% 
  ggplot(aes(x = situacao, y = n, fill =  classificacao_ambientalismo)) + 
  facet_grid(aspecto ~ ., scales = "free") + 
  geom_chicklet() + 
  escala_sinais + 
  coord_flip()
```
```{r}
prop_situacao = situacao %>% 
  filter(!is.na(situacao), !is.na(classificacao_ambientalismo)) %>% 
  group_by(aspecto, classificacao_ambientalismo) %>% 
  mutate(total_classe = n()) %>% 
  group_by(aspecto, situacao, classificacao_ambientalismo) %>% 
  filter(classificacao_ambientalismo != "Neutro") %>% 
  summarise(total = mean(total_classe), prop_situacao = n() / total, count_situacao = n())

prop_situacao %>% 
  filter(!(situacao %in% c("Ativa", "Sem urgência", "Ainda no início"))) %>% 
  ggplot(aes(x = situacao, y = prop_situacao, fill =  classificacao_ambientalismo)) + 
  facet_grid(reorder(aspecto, -prop_situacao) ~ ., scales = "free") + 
  geom_chicklet(position = "dodge") + 
  escala_sinais + 
  scale_y_percent() + 
  coord_flip()
```

## Proposições transformadas em lei

```{r}
aprovadas = proposicoes %>%
  filter(status == "Lei") %>%
  select(nome_proposicao, data_apresentacao, casa_origem, ementa)

aprovadas %>% reactable()
```

Eis seus autores:

```{r}
detalhes_autorias %>% 
  filter(proposicao %in% aprovadas$nome_proposicao) %>% 
  mutate(governismo = round(governismo, 1)) %>% 
  select(proposicao, proposicao, nome, partido, uf, casa, governismo) %>% View
  reactable()
```

```{r}
detalhes_autorias %>%
  filter(proposicao %in% aprovadas$nome_proposicao) %>%
  ggplot(aes(y = governismo, x = proposicao)) +
  geom_quasirandom() + 
  coord_flip() + 
  labs(title = "Governismo dos autores de proposições aprovadas", 
       )
```

